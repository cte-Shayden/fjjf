<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Universal Game Emulator</title>
<style>
body {
  font-family: sans-serif;
  background: #1e1e1e;
  color: #ddd;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 20px;
}
.container {
  max-width: 1000px;
  background: #2b2b2b;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 0 20px #0008;
}
button {
  background: #4a90e2;
  border: none;
  padding: 10px 20px;
  border-radius: 5px;
  color: #fff;
  cursor: pointer;
}
#canvas {
  width: 100%;
  background: #000;
  border-radius: 10px;
  margin-top: 20px;
}
.status { margin-top: 10px; }
</style>
</head>
<body>
<div class="container">
  <h1>üéÆ Universal Game Emulator</h1>
  <p>Supports: L√ñVE, Kristal, and lightweight EXE games (via BoxedWine)</p>

  <input type="file" id="fileInput" webkitdirectory directory multiple>
  <input type="file" id="singleFile" accept=".love,.zip,.exe">
  <button onclick="document.getElementById('singleFile').click()">Select File</button>

  <div id="status" class="status">No game loaded.</div>
  <canvas id="canvas"></canvas>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script>
const fileInput = document.getElementById('singleFile');
const canvas = document.getElementById('canvas');
const status = document.getElementById('status');

fileInput.addEventListener('change', async (e) => {
  const file = e.target.files[0];
  if (!file) return;

  const name = file.name.toLowerCase();
  if (name.endsWith('.love')) {
    runLoveGame(file);
  } else if (name.endsWith('.zip')) {
    runZipGame(file);
  } else if (name.endsWith('.exe')) {
    runExeGame(file);
  } else {
    status.textContent = '‚ùå Unsupported file type.';
  }
});

async function runLoveGame(file) {
  status.textContent = 'Loading L√ñVE game...';
  const buffer = await file.arrayBuffer();
  window.gameBuffer = buffer;

  loadLoveRuntime();
}

async function runZipGame(file) {
  status.textContent = 'Extracting zip...';
  const zip = await JSZip.loadAsync(await file.arrayBuffer());
  const files = {};
  for (const path in zip.files) {
    if (!zip.files[path].dir) {
      files[path] = await zip.files[path].async('uint8array');
    }
  }
  window.gameFiles = files;
  loadLoveRuntime();
}

function runExeGame(file) {
  status.textContent = 'Loading BoxedWine emulator...';
  const script = document.createElement('script');
  script.src = 'https://boxedwine.org/js/boxedwine.js';
  script.onload = () => {
    status.textContent = 'Running .exe (experimental)...';
    // BoxedWine init logic here
  };
  script.onerror = () => {
    status.textContent = '‚ùå Failed to load BoxedWine emulator.';
  };
  document.body.appendChild(script);
}

function loadLoveRuntime() {
  const script = document.createElement('script');
  script.src = 'https://rxi.github.io/love.js/love.js';
  script.onload = () => {
    status.textContent = '‚úÖ L√ñVE engine loaded!';
    // Files are written into FS in preRun (to be added)
  };
  script.onerror = () => {
    status.textContent = '‚ùå Failed to load L√ñVE runtime.';
  };
  document.body.appendChild(script);
}
</script>
</body>
</html>
